<div>
	<br>
	<div class="container">
		<mat-card class="card">
			<mat-card-title>
				<div fxFlex="50%" fxFlex.xs="100%" fxLayout="column">
					<mat-form-field>
						<mat-label>Filtro</mat-label>
						<input matInput (keyup)="applyFilter($event)" placeholder="Ex: Corante" #input>
					</mat-form-field>
				</div>
				<button type="button" mat-raised-button color="primary"
					style="float:inline-end; top: 30px; height: 40px" [disabled]="!AlgumProdutoComQtde()"
					(click)="scroll('fecharPedido')">Fechar Pedido</button>
			</mat-card-title>
			<mat-card-content>
				<div class="mat-elevation-z8" style="margin-top: 10px;">
					<mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort
						(matSortChange)="onSortData($any($event))">
						<ng-container *ngFor="let column of columns; let i = index" matColumnDef="{{ column.field }}">
							<mat-header-cell *matHeaderCellDef mat-sort-header>{{ column.display }}
							</mat-header-cell>
							<mat-cell *matCellDef="let row" (click)="edit(row['Id'], column.field)">
								<span *ngIf="i < 3" (click)="editRowId=-1">{{ row[column.field] }}</span>
								<span *ngIf="i == 4" (click)="editRowId=-1">{{ row[column.field] | currency }}</span>
								<ng-container *ngIf="i == 3 && row['Id'] !== editRowId">
									<span *ngIf="i == 3">{{ row[column.field] }}</span>
								</ng-container>
								<ng-container *ngIf="i == 3 && row['Id'] === editRowId">
									<!-- <input matInput type="number" appearance="standard" name="qProd"
										(ngModelChange)="row['qProd'] = $event === '' ? 0 : $event"
										[ngModel]="row['qProd']"> -->
									<!-- [(ngModel)]="row['qProd']" -->
									<mat-form-field appearance="outline">
										<mat-label>Quantidade</mat-label>
										<input matInput type="number" name="qProd"
											(ngModelChange)="row['qProd'] = $event === '' ? 0 : $event"
											[ngModel]="row['qProd']">
										<mat-icon matSuffix>mode_edit</mat-icon>
									</mat-form-field>
								</ng-container>
							</mat-cell>
						</ng-container>
						<mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
						<mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
						<!-- Group header -->
						<ng-container matColumnDef="groupHeader">
							<mat-cell colspan="999" *matCellDef="let group">
								<mat-icon *ngIf="group.expanded">expand_less</mat-icon>
								<mat-icon *ngIf="!group.expanded">expand_more</mat-icon>
								<!-- {{groupByColumns[group.level-1]}} -->
								<strong>
									{{group[groupByColumns[group.level-1]]}}
									({{group.totalCounts}})</strong>
							</mat-cell>
						</ng-container>
						<mat-row *matRowDef="let row; columns: ['groupHeader']; when: isGroup;"
							(click)="groupHeaderClick(row)"> </mat-row>
					</mat-table>
				</div>
			</mat-card-content>
		</mat-card>

		<br>

		<mat-card class="card" *ngIf="AlgumProdutoComQtde()" id="fecharPedido">

			<h2>Preencha os dados do cliente</h2>

			<form [formGroup]="form">
				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="50%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>CNPJ</mat-label>
							<input matInput placeholder="Buscar cliente" [textMask]="documentoMask"
								(keyup)="BuscarEmpresa($event)" SelectOnFoscus #inputCliente formControlName="cnpj">
							<button matSuffix mat-button>
								<mat-icon (click)="BuscarEmpresaIcon(inputCliente.value)">search</mat-icon>
							</button>
							<input matInput formControlName="Id" [hidden]="true">
							<mat-error *ngFor="let validation of validation_messages.cnpj">
								<mat-error class="error-message"
									*ngIf="form.controls['cnpj'].errors?.[validation.type] && (form.controls['cnpj'].dirty || form.controls['cnpj'].touched)">
									{{validation.message}}
								</mat-error>
							</mat-error>
						</mat-form-field>
					</div>

					<div>
						<button type="button" mat-raised-button color="primary"
							style="float:inline-end;margin-top: 10px" [disabled]="form.controls['nome'].value == ''"
							(click)="form.reset();">Limpar</button>
					</div>
					<div>
						<button type="button" mat-raised-button color="primary"
							style="float:inline-end;margin-top: 10px" [disabled]="form.controls['nome'].value == ''"
							(click)="SalvarPedido()">Salvar</button>
					</div>

				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="100%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Inscrição Estadual</mat-label>
							<input matInput placeholder="Inscrição Estadual" formControlName="IE">
						</mat-form-field>
					</div>
				</div>				

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="100%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Nome</mat-label>
							<input matInput placeholder="Nome do cliente" formControlName="nome" #inputNome>
							<mat-error *ngFor="let validation of validation_messages.nome">
								<mat-error class="error-message"
									*ngIf="form.controls['nome'].errors?.[validation.type] && (form.controls['nome'].dirty || form.controls['nome'].touched)">
									{{validation.message}}</mat-error>
							</mat-error>
						</mat-form-field>
					</div>
				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="100%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Fantasia</mat-label>
							<input matInput placeholder="Nome fantasia do cliente" formControlName="fantasia">
						</mat-form-field>
					</div>
				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="35%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<span matPrefix> </span>
							<mat-label>CEP</mat-label>
							<input matInput placeholder="CEP" formControlName="cep" (keyup.enter)="ObterEndereco()"
								appMaskCep appSelectOnFocus [textMask]="cepMask">
							<button matSuffix mat-button>
								<mat-icon (click)="ObterEndereco()">search</mat-icon>
							</button>
						</mat-form-field>
					</div>
					<div fxFlex="20%" fxFlex.xs="100%" fxLayout="column">
						<input type="checkbox" formControlName="me" id="me" class="form-check-input">
						<label class="form-check-label" for="indMe">Micro empresa?</label>
					</div>
				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="60%" fxFlex.xs="60%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Endereço</mat-label>
							<input matInput placeholder="Endereço do cliente" formControlName="endereco">
						</mat-form-field>
					</div>
					<div fxFlex="12%" fxFlex.xs="20%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Número</mat-label>
							<input matInput placeholder="Número do endereço" formControlName="numero">
						</mat-form-field>
					</div>
					<div fxFlex="18%" fxFlex.xs="20%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Complemento</mat-label>
							<input matInput placeholder="Complemento do endereço" formControlName="complemento">
						</mat-form-field>
					</div>
				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">
					<div fxFlex="35%" fxFlex.xs="40%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Bairro</mat-label>
							<input matInput placeholder="Bairro do cliente" formControlName="bairro">
						</mat-form-field>
					</div>
					<div fxFlex="35%" fxFlex.xs="40%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>Cidade</mat-label>
							<input matInput placeholder="Cidade do cliente" formControlName="cidade">
						</mat-form-field>
					</div>
					<div fxFlex="20%" fxFlex.xs="15%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>UF</mat-label>
							<mat-select matInput placeholder="UF" formControlName="uf">
								<mat-option value="-1">[ Selecione o estado ]</mat-option>
								<mat-option *ngFor="let uf of Estados" [value]="uf.key">
									{{ uf.key }}-{{ uf.value }}
								</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
				</div>

				<div fxLayout.xs="row wrap" fxLayoutGap="10px" fxLayoutGap.xs="2px">

					<div fxFlex="7%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<span matPrefix> </span>
							<mat-label>DDD</mat-label>
							<input matInput placeholder="DDD" formControlName="ddd" maxlength="2" appSelectOnFocus>
						</mat-form-field>
					</div>

					<div fxFlex="39%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>1º Telefone</mat-label>
							<span matPrefix></span>
							<mat-icon matPrefix>phone</mat-icon>
							<input matInput placeholder="1º telefone" formControlName="fone" [textMask]="foneMask"
								appSelectOnFocus>
						</mat-form-field>
					</div>

					<div fxFlex="7%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<span matPrefix> </span>
							<mat-label>DDD</mat-label>
							<input matInput placeholder="DDD" formControlName="ddd2" maxlength="2" appSelectOnFocus>
						</mat-form-field>
					</div>

					<div fxFlex="38%" fxFlex.xs="100%" fxLayout="column">
						<mat-form-field appearance="outline">
							<mat-label>2º Telefone</mat-label>
							<span matPrefix></span>
							<mat-icon matPrefix>phone</mat-icon>
							<input matInput placeholder="2º telefone" formControlName="fone2" [textMask]="foneMask"
								appSelectOnFocus>
						</mat-form-field>
					</div>
				</div>

				<div>
					<mat-form-field appearance="outline">
						<mat-label>E-mail</mat-label>
						<mat-icon matPrefix>email</mat-icon>
						<span matPrefix></span>
						<input formControlName="email" matInput placeholder="E-mail" maxlength="100" type="email">
						<mat-error *ngFor="let validation of validation_messages.email">
							<mat-error class="error-message"
								*ngIf="form.controls['email'].errors?.[validation.type] && (form.controls['email'].dirty || form.controls['email'].touched)">
								{{validation.message}}
							</mat-error>
						</mat-error>
					</mat-form-field>
				</div>

			</form>

		</mat-card>

	</div>
	<br>
</div>